<!DOCTYPE html>
<html lang="vi">
<!-- File ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t ƒë·ªÉ s·ª≠ d·ª•ng h√†m createDefaultTimeMarkers t·ª´ TimeCalculator -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMAG - PHA TH·ªúI GIAN (Phi√™n b·∫£n crypto)</title>
    <style>
        body {
            margin: 0;
            padding: 10px;
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            background-color: #f5f5f5;
        }
        
        header {
            text-align: center;
            margin-bottom: 15px;
        }
        
        h1 {
            color: #e01b24;
            font-size: 22px;
            margin-bottom: 5px;
        }
        
        .time-info {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .time-frame {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            background-color: white;
            transition: all 0.2s ease;
        }
        
        .time-frame:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-color: #ccc;
        }
        
        /* Hi·ªáu ·ª©ng hover ƒë·∫∑c bi·ªát cho S.Ch·ªß ƒê·∫°o v√† H·ªó Tr·ª£ */
        .time-frame[data-role="S.Ch·ªß ƒê·∫°o"]:hover {
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.2); /* ƒê·ªè t∆∞∆°i */
            border-color: rgba(220, 20, 60, 0.4);
        }
        
        .time-frame[data-role="Ch·ªß ƒê·∫°o"]:hover {
            box-shadow: 0 4px 12px rgba(255, 140, 0, 0.2); /* Cam ƒë·∫≠m */
            border-color: rgba(255, 140, 0, 0.4);
        }
        
        .time-frame[data-role="Giao Pha"] {
            border-left: 4px solid #000080; /* Xanh navy ƒë·∫≠m */
            background-color: rgba(0, 0, 128, 0.05);
            box-shadow: 0 2px 5px rgba(0, 0, 128, 0.15);
        }
        
        /* Hi·ªáu ·ª©ng hover cho Giao Pha */
        .time-frame[data-role="Giao Pha"]:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 128, 0.25); /* Xanh navy ƒë·∫≠m */
            border-color: rgba(0, 0, 128, 0.5);
        }
        
        .time-frame[data-role="H·ªó Tr·ª£"]:hover {
            box-shadow: 0 4px 12px rgba(34, 139, 34, 0.2); /* Xanh l√° ƒë·∫≠m */
            border-color: rgba(34, 139, 34, 0.4);
        }
        
        .time-frame[data-role="K.Ch·ªß ƒê·∫°o"] {
            border-left: 4px solid #4169E1; /* Xanh d∆∞∆°ng */
            border-left-style: dashed;
            background-color: rgba(65, 105, 225, 0.02);
        }
        
        .time-frame-header {
            width: 90px;
            text-align: left;
            padding-right: 15px;
            border-right: 1px solid #eee;
            margin-right: 15px;
        }
        
        .time-frame-name {
            font-weight: bold;
            font-size: 16px;
            color: #ff0000;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .time-frame-date {
            font-size: 10px;
            color: #333;
            margin-top: 2px;
            font-family: monospace;
        }
        
        .time-frame-content {
            flex: 1;
        }
        
        .time-frame-stats {
            margin-top: 3px;
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #555;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .frame-name-info {
            font-weight: bold;
            color: #e01b24;
            flex: 0 0 auto;
            margin-right: 3px;
        }
        
        .time-remaining {
            font-weight: bold;
            flex: 0 0 auto;
        }
        
        .time-progress {
            color: #2a6fc9;
            flex: 0 0 auto;
        }
        
        .time-halfway {
            font-weight: bold;
            font-family: monospace;
            flex: 0 0 auto;
        }
        
        .phase-name {
            color: #2a6fc9;
            font-weight: bold;
            flex: 0 0 auto;
        }
        
        .timeline {
            display: flex;
            height: 14px;
            width: 100%;
            border-radius: 3px;
            overflow: visible;
            position: relative;
            margin-bottom: 60px; /* Kho·∫£ng c√°ch b√™n d∆∞·ªõi */
            box-shadow: none;
            border: 1px solid #0c4a6e;
            background-color: #0c4a6e;
            margin-top: 45px; /* TƒÉng kho·∫£ng c√°ch ph√≠a tr√™n ƒë·ªÉ c√≥ ch·ªó hi·ªÉn th·ªã ng√†y/gi·ªù */
        }
        
        .phase {
            width: 25%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0c4a6e;
            font-weight: bold;
            font-size: 8px;
            border-right: 1px solid #0c4a6e;
            box-sizing: border-box;
            text-shadow: none;
        }
        
        /* Lo·∫°i b·ªè border-right cho √¥ cu·ªëi c√πng */
        .phase:last-child {
            border-right: none;
        }
        
        .phase1 { background-color: #0ea5e9; } /* Xanh d∆∞∆°ng ƒë·∫≠m */
        .phase2 { background-color: #10b981; } /* Xanh l√° ƒë·∫≠m */
        .phase3 { background-color: #eab308; } /* V√†ng ƒë·∫≠m */
        .phase4 { background-color: #ec4899; } /* H·ªìng ƒë·∫≠m */
        
        /* Th√™m hi·ªáu ·ª©ng animation cho ch·ªâ b√°o NOW */
        @keyframes nowPulse {
            0% { opacity: 0.9; }
            50% { opacity: 1; }
            100% { opacity: 0.9; }
        }
        
        .now-indicator {
            position: absolute;
            top: -12px;
            height: calc(100% + 24px);
            width: 2px;
            background-color: red;
            z-index: 5;
            transition: left 1s linear;
            animation: nowPulse 2s infinite;
        }
        
        .now-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            color: red;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 10px;
            white-space: nowrap;
            font-weight: bold;
            border: 1px solid red;
            z-index: 100;
            pointer-events: none;
        }
        
        .time-markers {
            display: flex;
            justify-content: space-between;
            margin-top: 3px;
            font-size: 9px;
            color: #666;
            font-family: monospace;
            position: absolute;
            width: 100%;
            top: -25px; /* ƒêi·ªÅu ch·ªânh l√™n cao h∆°n ƒë·ªÉ c√≥ ch·ªó cho 2 d√≤ng */
        }
        
        .time-marker {
            text-align: center;
            position: absolute;
            font-family: monospace;
            font-size: 9px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 45px; /* ƒê·∫£m b·∫£o chi·ªÅu r·ªông t·ªëi thi·ªÉu cho n·ªôi dung */
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.8);
            padding: 3px 4px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .time-marker span {
            display: block;
            line-height: 1.3;
        }
        
        .time-marker.now {
            color: red;
            font-weight: bold;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 3px 4px;
            border: 1px solid red;
            border-radius: 4px;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(255,0,0,0.2);
        }
        
        /* Th√™m style cho c√°c d·∫•u ch·∫•m th·ªùi gian */
        .timeline-dot {
            position: absolute;
            transform: translate(-50%, -50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #000;
            z-index: 10;
            top: 0; /* ƒê·∫∑t d·∫•u ch·∫•m n·∫±m tr√™n vi·ªÅn c·ªßa timeline */
            cursor: pointer;
            border: 1px solid white;
        }
        
        .timeline-dot:hover {
            width: 8px;
            height: 8px;
            background-color: #e01b24;
            box-shadow: 0 0 5px rgba(255,255,255,0.8);
        }
        
        /* Style cho nh√£n th·ªùi gian */
        .timeline-dot-label {
            position: absolute;
            transform: translate(-50%, 0);
            font-size: 10px;
            color: #333;
            font-family: monospace;
            white-space: nowrap;
            text-align: center;
            font-weight: bold;
            opacity: 0.95;
            top: -22px;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 3px 6px;
            border-radius: 3px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            z-index: 25;
            border: 1px solid #ddd;
        }
        
        /* Th√™m style cho nh√£n Q tr√™n d·∫•u ch·∫•m */
        .q-label {
            position: absolute;
            font-size: 8px;
            font-weight: bold;
            color: #000;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            text-shadow: 0px 0px 2px white;
            z-index: 9;
        }
        
        /* Th√™m style cho now-container */
        .now-svg-container {
            position: absolute;
            z-index: 15;
            top: 0;
            height: 100%;
            width: 40px;
            overflow: visible;
            transform: translateX(-50%);
            pointer-events: none;
        }
        
        /* ƒê·ªãnh nghƒ©a ph·∫ßn trƒÉm hi·ªÉn th·ªã */
        .now-percentage {
            position: absolute;
            bottom: -20px;
            transform: translateX(-50%);
            font-size: 9px;
            color: red;
            font-weight: bold;
            font-family: monospace;
            white-space: nowrap;
            background-color: white;
            padding: 1px 4px;
            border: 1px solid red;
            border-radius: 2px;
            z-index: 15;
        }

        .filter-section {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
            position: relative;
        }
        
        .filter-button {
            padding: 5px 10px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 12px;
        }
        
        .filter-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 200px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .role-tag {
            display: inline-block;
            padding: 1px 4px;
            border-radius: 3px;
            margin-left: 3px;
            font-size: 9px;
            color: white;
            font-weight: bold;
        }

        .role-Si√™u-Chu-Dao { 
            background-color: #DC143C; /* ƒê·ªè t∆∞∆°i - Vai tr√≤ quan tr·ªçng nh·∫•t */
            color: #FFFFCC; /* M√†u v√†ng nh·∫°t ƒë·ªÉ d·ªÖ ƒë·ªçc h∆°n tr√™n n·ªÅn ƒë·ªè */
            font-weight: bold; 
            font-size: 10px;
            padding: 2px 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            text-shadow: 0 0 1px #000; /* Th√™m vi·ªÅn ƒëen m·ªèng ƒë·ªÉ tƒÉng ƒë·ªô t∆∞∆°ng ph·∫£n */
        }
        .role-Ch·ªß-ƒê·∫°o { 
            background-color: #FF8C00; /* Cam ƒë·∫≠m - Vai tr√≤ ch·ªß ƒë·∫°o, n·ªïi b·∫≠t */
            color: #000000; /* M√†u ƒëen ƒë·ªÉ d·ªÖ ƒë·ªçc h∆°n tr√™n n·ªÅn cam */
            font-weight: bold;
            text-shadow: 0 0 1px #FFFFFF; /* Th√™m vi·ªÅn tr·∫Øng m·ªèng ƒë·ªÉ tƒÉng ƒë·ªô t∆∞∆°ng ph·∫£n */
        }
        .role-Giao-Pha { 
            background-color: #000080; /* Xanh navy ƒë·∫≠m - Vai tr√≤ giao thoa */
            color: #FFFFFF; /* M√†u tr·∫Øng */
            font-weight: bold;
            font-size: 10px;
            padding: 2px 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            text-shadow: 0 0 2px #000, 0 0 3px #000; /* TƒÉng c∆∞·ªùng vi·ªÅn ƒëen ƒë·ªÉ tƒÉng ƒë·ªô t∆∞∆°ng ph·∫£n */
        }
        .role-H·ªó-Tr·ª£ { 
            background-color: #228B22; /* Xanh l√° ƒë·∫≠m - Vai tr√≤ h·ªó tr·ª£, tƒÉng tr∆∞·ªüng */
            color: #FFFFCC; /* M√†u v√†ng nh·∫°t ƒë·ªÉ d·ªÖ ƒë·ªçc h∆°n tr√™n n·ªÅn xanh l√° */
            font-weight: bold; 
            font-size: 10px;
            padding: 2px 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            text-shadow: 0 0 1px #000; /* Th√™m vi·ªÅn ƒëen m·ªèng ƒë·ªÉ tƒÉng ƒë·ªô t∆∞∆°ng ph·∫£n */
        }
        .role-K-Ch·ªß-ƒê·∫°o { 
            background-color: #4169E1; /* Xanh d∆∞∆°ng - Vai tr√≤ ph·ª• */
            color: #FFFFFF; /* Gi·ªØ m√†u tr·∫Øng v√¨ ƒë·ªß t∆∞∆°ng ph·∫£n tr√™n n·ªÅn xanh d∆∞∆°ng */
            font-weight: bold;
            text-shadow: 0 0 1px #000; /* Th√™m vi·ªÅn ƒëen m·ªèng ƒë·ªÉ tƒÉng ƒë·ªô t∆∞∆°ng ph·∫£n */
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            font-size: 18px;
            color: #555;
            margin: 20px 0;
            padding: 20px;
            border: 1px dashed #ccc;
            border-radius: 8px;
            background-color: #f9f9f9;
        }

        .loading:after {
            content: "...";
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: "."; }
            40% { content: ".."; }
            60%, 100% { content: "..."; }
        }

        .bmag-info {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            text-align: center;
        }
        
        .bmag-info p {
            margin: 0;
            font-weight: bold;
        }

        .advice-section {
            margin-top: 3px;
            font-style: italic;
            color: #555;
            font-size: 11px;
        }

        .special-alert {
            background-color: #FFF3CD;
            border: 1px solid #FFEEBA;
            color: #856404;
            padding: 8px 15px;
            border-radius: 4px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            display: none;
        }

        /* Th√™m hi·ªáu ·ª©ng ƒë∆∞·ªùng vi·ªÅn c·ªßa pha hi·ªán t·∫°i */
        .phase-active {
            border: 1px solid rgba(255,255,255,0.7) !important;
            box-shadow: inset 0 0 3px rgba(255,255,255,0.5);
        }

        .color-settings {
            margin: 10px 0;
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            display: none;
        }
        
        .color-picker-group {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .color-picker-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 5px;
        }
        
        .color-picker-item label {
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 12px;
        }
        
        .color-picker-item input[type="color"] {
            width: 40px;
            height: 30px;
            cursor: pointer;
        }
        
        .settings-button {
            padding: 5px 10px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
        }

        /* Style cho nh√£n th·ªùi gian nh·ªè tr√™n m·ªói d·∫•u ch·∫•m */
        .mini-time-label {
            position: absolute;
            font-size: 8px;
            font-weight: normal;
            color: #333;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.85);
            padding: 1px 3px;
            border-radius: 3px;
            white-space: nowrap;
            z-index: 8;
            display: none; /* ·∫®n m·∫∑c ƒë·ªãnh, ch·ªâ hi·ªÉn th·ªã khi hover */
            border: 1px solid transparent;
        }
        
        .timeline-dot:hover .mini-time-label {
            display: block;
            font-weight: bold;
            z-index: 16;
            border-color: #ddd;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        /* Style cho nh√£n hi·ªÉn th·ªã ng√†y */
        .timeline-date-label {
            position: absolute;
            transform: translate(-50%, 0);
            font-size: 8px;
            color: #333;
            font-family: monospace;
            white-space: nowrap;
            text-align: center;
            font-weight: bold;
            opacity: 0.9;
            bottom: -18px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 1px 3px;
            border-radius: 3px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            z-index: 20;
        }

        /* Th√™m style cho khung th·ªùi gian hi·ªán t·∫°i ƒëang ·ªü Q3 */
        .time-frame[data-phase="Q3"] {
            border: 1px solid rgba(234, 179, 8, 0.5);
            box-shadow: 0 2px 8px rgba(234, 179, 8, 0.2);
        }
        
        /* Th√™m style cho khung th·ªùi gian g·∫ßn 50% */
        .time-frame[data-near-half="true"] {
            border: 1px solid rgba(59, 130, 246, 0.5);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
        }
        
        /* Th√™m style cho khung th·ªùi gian ƒëang ƒë∆∞·ª£c xem */
        .time-frame:target {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }
        
        /* T·∫°o kho·∫£ng c√°ch gi·ªØa c√°c nh√≥m khung th·ªùi gian */
        .time-frame-group-separator {
            height: 1px;
            background-color: #eee;
            margin: 25px 0;
            position: relative;
        }
        
        .time-frame-group-separator::before {
            content: attr(data-label);
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #f5f5f5;
            padding: 0 10px;
            font-size: 12px;
            color: #666;
            font-weight: bold;
        }

        /* Th√™m m√†u n·ªÅn nh·∫°t cho c√°c khung th·ªùi gian theo vai tr√≤ */
        .time-frame[data-role="S.Ch·ªß ƒê·∫°o"] {
            border-left: 4px solid #DC143C; /* ƒê·ªè t∆∞∆°i */
            background-color: rgba(220, 20, 60, 0.03);
            box-shadow: 0 2px 5px rgba(220, 20, 60, 0.1);
        }
        
        .time-frame[data-role="Ch·ªß ƒê·∫°o"] {
            border-left: 4px solid #FF8C00; /* Cam ƒë·∫≠m */
            background-color: rgba(255, 140, 0, 0.03);
            box-shadow: 0 2px 5px rgba(255, 140, 0, 0.1);
        }
        
        .time-frame[data-role="Giao Pha"] {
            border-left: 4px solid #000080; /* Xanh navy ƒë·∫≠m */
            background-color: rgba(0, 0, 128, 0.03);
        }
        
        .time-frame[data-role="H·ªó Tr·ª£"] {
            border-left: 4px solid #228B22; /* Xanh l√° ƒë·∫≠m */
            background-color: rgba(34, 139, 34, 0.03);
            box-shadow: 0 2px 5px rgba(34, 139, 34, 0.1);
        }
        
        .time-frame[data-role="K.Ch·ªß ƒê·∫°o"] {
            border-left: 4px solid #4169E1; /* Xanh d∆∞∆°ng */
            border-left-style: dashed;
            background-color: rgba(65, 105, 225, 0.02);
        }
        
        /* Hi·ªáu ·ª©ng hover ƒë·∫∑c bi·ªát cho c√°c vai tr√≤ */
        .time-frame[data-role="S.Ch·ªß ƒê·∫°o"]:hover {
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.2); /* ƒê·ªè t∆∞∆°i */
            border-color: rgba(220, 20, 60, 0.4);
        }
        
        .time-frame[data-role="Ch·ªß ƒê·∫°o"]:hover {
            box-shadow: 0 4px 12px rgba(255, 140, 0, 0.2); /* Cam ƒë·∫≠m */
            border-color: rgba(255, 140, 0, 0.4);
        }
        
        .time-frame[data-role="H·ªó Tr·ª£"]:hover {
            box-shadow: 0 4px 12px rgba(34, 139, 34, 0.2); /* Xanh l√° ƒë·∫≠m */
            border-color: rgba(34, 139, 34, 0.4);
        }

        /* Hi·ªáu ·ª©ng hover ƒë·∫∑c bi·ªát cho Si√™u Ch·ªß ƒê·∫°o v√† H·ªó Tr·ª£ */
        .time-frame[data-role="Si√™u Ch·ªß ƒê·∫°o"]:hover {
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.2); /* ƒê·ªè t∆∞∆°i */
            border-color: rgba(220, 20, 60, 0.4);
        }

        /* Th√™m m√†u n·ªÅn nh·∫°t cho c√°c khung th·ªùi gian theo vai tr√≤ */
        .time-frame[data-role="Si√™u Ch·ªß ƒê·∫°o"] {
            border-left: 4px solid #DC143C; /* ƒê·ªè t∆∞∆°i */
            background-color: rgba(220, 20, 60, 0.03);
            box-shadow: 0 2px 5px rgba(220, 20, 60, 0.1);
        }

        .role-Si√™u-Ch·ªß-ƒê·∫°o { 
            background-color: #DC143C; /* ƒê·ªè t∆∞∆°i - Vai tr√≤ quan tr·ªçng nh·∫•t */
            color: #FFFFCC; /* M√†u v√†ng nh·∫°t ƒë·ªÉ d·ªÖ ƒë·ªçc h∆°n tr√™n n·ªÅn ƒë·ªè */
            font-weight: bold; 
            font-size: 10px;
            padding: 2px 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            text-shadow: 0 0 1px #000; /* Th√™m vi·ªÅn ƒëen m·ªèng ƒë·ªÉ tƒÉng ƒë·ªô t∆∞∆°ng ph·∫£n */
        }
    </style>
</head>
<body>
    <div id="time-frames-container">
        <div class="loading" style="display: flex; justify-content: center; align-items: center; height: 100px; font-size: 18px; color: #555; margin: 20px 0; padding: 20px; border: 1px dashed #ccc; border-radius: 8px; background-color: #f9f9f9;">
            <span>‚è≥ ƒêang t·∫£i d·ªØ li·ªáu BMAG...</span>
        </div>
    </div>
    
    <!-- Di chuy·ªÉn th√¥ng tin quan tr·ªçng xu·ªëng cu·ªëi trang -->
    <div class="footer-info" style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 15px;">
        <h2 style="color: #e01b24; font-size: 18px; margin-bottom: 5px; text-align: center;">BMAG - PHA TH·ªúI GIAN (CRYPTO - VI·ªÜT NAM)</h2>
        <div style="text-align: center; font-weight: bold; font-size: 14px;" id="footer-current-time">
            NOW: ƒêang c·∫≠p nh·∫≠t...
        </div>
        <div style="text-align: center; font-size: 11px; color: #666; margin-top: 5px;">
            * Th·ªùi gian th·ªã tr∆∞·ªùng Crypto: 24/7 (GMT+7)
        </div>
        
        <div id="footer-bmag-info" style="margin: 10px 0; padding: 8px; background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 4px; text-align: center; font-size: 11px;">
            <span id="footer-timeframe-info">üïñ ƒêang t√≠nh to√°n...</span>
        </div>
        
        <div id="footer-special-alert" style="margin: 10px 0; padding: 8px; background-color: #FFF3CD; border: 1px solid #FFEEBA; color: #856404; border-radius: 4px; text-align: center; font-weight: bold; font-size: 11px; display: none;">
            <span class="warning-icon">‚ö†Ô∏è</span>
            <span id="footer-alert-message"></span>
        </div>
        
        <!-- Th√™m n√∫t c√†i ƒë·∫∑t m√†u s·∫Øc -->
        <div style="text-align: center; margin-top: 10px;">
            <button id="color-settings-button" class="settings-button">‚öôÔ∏è ƒêi·ªÅu ch·ªânh m√†u s·∫Øc</button>
        </div>
        
        <!-- Th√™m ph·∫ßn c√†i ƒë·∫∑t m√†u s·∫Øc -->
        <div id="color-settings" class="color-settings">
            <h3 style="margin-top: 0; font-size: 14px;">ƒêi·ªÅu ch·ªânh m√†u s·∫Øc c√°c pha</h3>
            <div class="color-picker-group">
                <div class="color-picker-item">
                    <label for="phase1-color">Q1 (1/4 ƒë·∫ßu)</label>
                    <input type="color" id="phase1-color" value="#0ea5e9">
                </div>
                <div class="color-picker-item">
                    <label for="phase2-color">Q2 (1/4 th·ª© 2)</label>
                    <input type="color" id="phase2-color" value="#10b981">
                </div>
                <div class="color-picker-item">
                    <label for="phase3-color">Q3 (1/4 th·ª© 3)</label>
                    <input type="color" id="phase3-color" value="#eab308">
                </div>
                <div class="color-picker-item">
                    <label for="phase4-color">Q4 (1/4 cu·ªëi)</label>
                    <input type="color" id="phase4-color" value="#ec4899">
                </div>
            </div>
            <button id="apply-colors" class="settings-button">√Åp d·ª•ng m√†u s·∫Øc</button>
            <button id="reset-colors" class="settings-button">Kh√¥i ph·ª•c m·∫∑c ƒë·ªãnh</button>
        </div>
        
        <!-- Di chuy·ªÉn b·ªô l·ªçc xu·ªëng footer -->
        <div class="filter-section" style="justify-content: center; margin-top: 10px;">
            <div class="filter-button" id="filter-button" style="font-size: 11px; background-color: #f0f0f0; border: 1px solid #ddd; border-radius: 3px; padding: 4px 8px;">
                <span>üîç L·ªçc khung th·ªùi gian: </span>
                <span id="filter-status">T·∫•t c·∫£</span>
                <span style="margin-left: 5px">‚ñº</span>
            </div>
            
            <div class="filter-dropdown" id="filter-dropdown" style="z-index: 1000; bottom: 100%; top: auto;">
                <div class="checkbox-item">
                    <input type="checkbox" id="all" checked>
                    <label for="all">T·∫•t c·∫£ khung th·ªùi gian</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-Si√™u-Ch·ªß-ƒê·∫°o" checked>
                    <label for="filter-Si√™u-Ch·ªß-ƒê·∫°o">Si√™u Ch·ªß ƒê·∫°o</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-Chu-Dao" checked>
                    <label for="filter-Chu-Dao">Ch·ªß ƒê·∫°o</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-Giao-Pha" checked>
                    <label for="filter-Giao-Pha">Giao Pha</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-Ho-Tro" checked>
                    <label for="filter-Ho-Tro">H·ªó Tr·ª£</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-K-Chu-Dao" checked>
                    <label for="filter-K-Chu-Dao">Kh√¥ng Ch·ªß ƒê·∫°o</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-Q3-only">
                    <label for="filter-Q3-only">Ch·ªâ hi·ªán Q3 (Cao tr√†o)</label>
                </div>
            </div>
        </div>
    </div>

    <script src="bmag-analyzer.js"></script>
    <script>
        // Ch·ªù t·∫•t c·∫£ n·ªôi dung HTML ƒë∆∞·ª£c t·∫£i xong
        document.addEventListener('DOMContentLoaded', function() {
            // Hi·ªÉn th·ªã th√¥ng b√°o ƒëang t·∫£i
            const loadingElement = document.querySelector('.loading');
            if (loadingElement) {
                loadingElement.style.display = 'flex';
                loadingElement.textContent = 'ƒêang t·∫£i d·ªØ li·ªáu...';
            }
            
            // Ki·ªÉm tra xem c√≥ th·ªÉ k·∫øt n·ªëi v·ªõi BMaGAnalyzer kh√¥ng
            if (typeof BMaGAnalyzer === 'undefined') {
                if (loadingElement) {
                    loadingElement.textContent = 'L·ªói: Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu BMAG. Vui l√≤ng l√†m m·ªõi trang.';
                    loadingElement.style.color = 'red';
                }
                return;
            }
            
            // Bi·∫øn l∆∞u tr·ªØ tr·∫°ng th√°i l·ªçc
            let activeFilters = {
                'Si√™u Ch·ªß ƒê·∫°o': true,
                'Ch·ªß ƒê·∫°o': true,
                'Giao Pha': true,
                'H·ªó Tr·ª£': true,
                'K.Ch·ªß ƒê·∫°o': true,
                'Q3Only': false
            };

            // H√†m c·∫≠p nh·∫≠t th·ªùi gian hi·ªán t·∫°i
            function updateCurrentTime() {
                const timeInfo = BMaGAnalyzer.updateCurrentTime();
                
                document.getElementById('footer-current-time').textContent = `NOW: ${timeInfo.formatted}`;
                
                // C·∫≠p nh·∫≠t th√¥ng tin th·ªùi gian crypto
                updateCryptoTimeInfo();
                
                return timeInfo.now;
            }
            
            // C·∫≠p nh·∫≠t th√¥ng tin th·ªùi gian crypto
            function updateCryptoTimeInfo() {
                const now = new Date();
                // Chuy·ªÉn ƒë·ªïi sang gi·ªù Vi·ªát Nam (UTC+7)
                const vnTime = new Date(now.getTime() + 7 * 60 * 60 * 1000);
                
                // Ki·ªÉm tra theo quy t·∫Øc BMaG (ng√†y m·ªõi b·∫Øt ƒë·∫ßu t·ª´ 7h s√°ng)
                const currentHour = vnTime.getUTCHours();
                const currentDate = `${String(vnTime.getUTCDate()).padStart(2, '0')}/${String(vnTime.getUTCMonth() + 1).padStart(2, '0')}/${vnTime.getUTCFullYear()}`;
                
                let infoText;
                if (currentHour < 7) {
                    // Tr∆∞·ªõc 7h s√°ng - v·∫´n l√† ng√†y h√¥m tr∆∞·ªõc
                    const yesterday = new Date(vnTime);
                    yesterday.setUTCDate(yesterday.getUTCDate() - 1);
                    const bmagDate = `${String(yesterday.getUTCDate()).padStart(2, '0')}/${String(yesterday.getUTCMonth() + 1).padStart(2, '0')}/${yesterday.getUTCFullYear()}`;
                    
                    infoText = `üïñ Th·ªùi gian hi·ªán t·∫°i: ${currentDate} ${String(currentHour).padStart(2, '0')}:${String(vnTime.getUTCMinutes()).padStart(2, '0')} (GMT+7)
                        <br><b>üìÖ Theo BMaG:</b> V·∫´n thu·ªôc ng√†y ${bmagDate} (ƒë·∫øn 07:00 s√°ng)`;
                } else {
                    // T·ª´ 7h s√°ng tr·ªü ƒëi - ƒë√£ sang ng√†y m·ªõi
                    infoText = `üïñ Th·ªùi gian hi·ªán t·∫°i: ${currentDate} ${String(currentHour).padStart(2, '0')}:${String(vnTime.getUTCMinutes()).padStart(2, '0')} (GMT+7)
                        <br><b>üìÖ Theo BMaG:</b> ƒê√£ sang ng√†y m·ªõi (t·ª´ 07:00 s√°ng)`;
                }
                
                document.getElementById('footer-timeframe-info').innerHTML = infoText;
            }

            // T·∫°o HTML cho c√°c khung th·ªùi gian
            function createTimeFrames() {
                const container = document.getElementById('time-frames-container');
                
                try {
                    // L·∫•y d·ªØ li·ªáu t·ª´ BMaGAnalyzer
                    const timeframeData = BMaGAnalyzer.generateTimeframeData();
                    
                    // X√≥a th√¥ng b√°o loading
                    container.innerHTML = '';
                    
                    // L·ªçc d·ªØ li·ªáu theo filter ƒëang √°p d·ª•ng
                    const filteredData = timeframeData.filter(tf => {
                        // Ki·ªÉm tra n·∫øu vai tr√≤ c·ªßa timeframe c√≥ trong filter hi·ªán t·∫°i
                        const roleMatch = activeFilters[tf.role];
                        
                        // Ki·ªÉm tra n·∫øu Q3Only filter ƒë∆∞·ª£c b·∫≠t
                        const phaseMatch = !activeFilters.Q3Only || tf.phase === "Q3";
                        
                        return roleMatch && phaseMatch;
                    });
                    
                    // Ki·ªÉm tra v√† hi·ªÉn th·ªã c·∫£nh b√°o ƒë·∫∑c bi·ªát
                    checkSpecialAlerts(timeframeData);
                    
                    // Hi·ªÉn th·ªã th√¥ng b√°o n·∫øu kh√¥ng c√≥ d·ªØ li·ªáu
                    if (filteredData.length === 0) {
                        container.innerHTML = '<div class="loading" style="display: flex; justify-content: center; align-items: center; height: 100px; font-size: 18px; color: #555; margin: 20px 0; padding: 20px; border: 1px dashed #ccc; border-radius: 8px; background-color: #f9f9f9;">Kh√¥ng c√≥ khung th·ªùi gian n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc</div>';
                        return;
                    }
                    
                    // ·∫®n th√¥ng b√°o "ƒêang t·∫£i d·ªØ li·ªáu" n·∫øu c√≥ d·ªØ li·ªáu
                    const loadingElements = document.querySelectorAll('.loading');
                    loadingElements.forEach(el => {
                        el.style.display = 'none';
                    });
                    
                    // Nh√≥m c√°c khung th·ªùi gian theo vai tr√≤
                    const groupedData = {
                        'Si√™u Ch·ªß ƒê·∫°o': [],
                        'Ch·ªß ƒê·∫°o': [],
                        'Giao Pha': [],
                        'H·ªó Tr·ª£': [],
                        'K.Ch·ªß ƒê·∫°o': []
                    };
                    
                    filteredData.forEach(tf => {
                        if (groupedData[tf.role]) {
                            groupedData[tf.role].push(tf);
                        }
                    });
                    
                    // C√°c nh√≥m vai tr√≤ theo th·ª© t·ª± hi·ªÉn th·ªã
                    const roleGroups = ['Si√™u Ch·ªß ƒê·∫°o', 'Ch·ªß ƒê·∫°o', 'Giao Pha', 'H·ªó Tr·ª£', 'K.Ch·ªß ƒê·∫°o'];
                    
                    // T·∫°o HTML cho t·ª´ng nh√≥m
                    roleGroups.forEach((role, index) => {
                        const timeframes = groupedData[role];
                        
                        // B·ªè qua nh√≥m kh√¥ng c√≥ d·ªØ li·ªáu
                        if (timeframes.length === 0) return;
                        
                        // Th√™m ph√¢n c√°ch gi·ªØa c√°c nh√≥m (tr·ª´ nh√≥m ƒë·∫ßu ti√™n)
                        if (index > 0) {
                            const separator = document.createElement('div');
                            separator.className = 'time-frame-group-separator';
                            separator.setAttribute('data-label', role);
                            container.appendChild(separator);
                        } else {
                            // ƒê·ªëi v·ªõi nh√≥m ƒë·∫ßu ti√™n, th√™m ti√™u ƒë·ªÅ nh∆∞ng kh√¥ng c√≥ ƒë∆∞·ªùng ph√¢n c√°ch
                            const heading = document.createElement('h3');
                            heading.style.fontSize = '14px';
                            heading.style.color = '#666';
                            heading.style.margin = '10px 0';
                            heading.style.fontWeight = 'bold';
                            heading.textContent = role;
                            container.appendChild(heading);
                        }
                        
                        // T·∫°o HTML cho m·ªói khung th·ªùi gian trong nh√≥m
                        timeframes.forEach(tf => {
                            try {
                                // T·∫°o container ch√≠nh
                                const timeFrameDiv = document.createElement('div');
                                timeFrameDiv.className = 'time-frame';
                                timeFrameDiv.setAttribute('data-role', tf.role);
                                timeFrameDiv.setAttribute('data-phase', tf.phase);
                                
                                // ƒê√°nh d·∫•u khung th·ªùi gian g·∫ßn 50%
                                if (tf.percent >= 45 && tf.percent <= 55) {
                                    timeFrameDiv.setAttribute('data-near-half', 'true');
                                }
                                
                                // Th√™m ID ƒë·ªÉ c√≥ th·ªÉ nh·∫£y ƒë·∫øn khung th·ªùi gian n√†y
                                const safeId = tf.name.replace(/\s+/g, '-').replace(/[^a-zA-Z0-9-]/g, '');
                                timeFrameDiv.id = `timeframe-${safeId}`;
                                
                                // T·∫°o ph·∫ßn header
                                const headerDiv = document.createElement('div');
                                headerDiv.className = 'time-frame-header';
                                
                                const nameDiv = document.createElement('div');
                                nameDiv.className = 'time-frame-name';
                                
                                // T·∫°o nh√£n vai tr√≤
                                const roleClass = 'role-' + tf.role.replace(/\./g, '-').replace(/\s+/g, '-');
                                nameDiv.innerHTML = `${tf.name} <span class="role-tag ${roleClass}">${tf.role}</span>`;
                                
                                const dateDiv = document.createElement('div');
                                dateDiv.className = 'time-frame-date';
                                dateDiv.textContent = tf.startDate;
                                
                                headerDiv.appendChild(nameDiv);
                                headerDiv.appendChild(dateDiv);
                                timeFrameDiv.appendChild(headerDiv);
                                
                                // T·∫°o ph·∫ßn n·ªôi dung
                                const contentDiv = document.createElement('div');
                                contentDiv.className = 'time-frame-content';
                                
                                // T·∫°o timeline
                                const timelineDiv = document.createElement('div');
                                timelineDiv.className = 'timeline';
                                
                                // Th√™m c√°c pha v·ªõi k√≠ch th∆∞·ªõc b·∫±ng nhau
                                const phases = ['Q1', 'Q2', 'Q3', 'Q4'];
                                const phaseClasses = ['phase1', 'phase2', 'phase3', 'phase4'];
                                
                                for(let i = 0; i < 4; i++) {
                                    const phaseDiv = document.createElement('div');
                                    phaseDiv.className = `phase ${phaseClasses[i]}`;
                                    phaseDiv.textContent = phases[i] + '.';
                                    phaseDiv.style.width = '25%';
                                    timelineDiv.appendChild(phaseDiv);
                                    
                                    // ƒê√°nh d·∫•u pha hi·ªán t·∫°i
                                    if(phases[i] === tf.phase) {
                                        phaseDiv.style.opacity = "1";
                                        phaseDiv.style.fontWeight = "bold";
                                        phaseDiv.classList.add('phase-active');
                                    }
                                }
                                
                                // T·∫°o SVG cho NOW
                                const nowSvgContainer = document.createElement('div');
                                nowSvgContainer.className = 'now-svg-container';
                                nowSvgContainer.style.left = `${tf.percent}%`;
                                // X·ª≠ l√Ω ID an to√†n cho element
                                nowSvgContainer.id = `now-marker-${safeId}`;
                                
                                // T·∫°o SVG inline ch·ª©a c·∫£ v·∫°ch ƒë·ªè v√† ch·ªØ NOW
                                nowSvgContainer.innerHTML = `
                                    <svg width="40" height="40" style="overflow: visible; position: absolute; left: -20px; top: -20px;">
                                        <!-- V·∫°ch ƒë·ªè d·ªçc -->
                                        <line x1="20" y1="20" x2="20" y2="40" stroke="red" stroke-width="2.5" />
                                        
                                        <!-- Thanh ngang ph√≠a tr√™n -->
                                        <line x1="5" y1="20" x2="35" y2="20" stroke="red" stroke-width="2.5" />
                                        
                                        <!-- Ch·ªØ NOW -->
                                        <rect x="5" y="5" width="30" height="14" fill="white" stroke="red" stroke-width="1.5" rx="3" />
                                        <text x="20" y="16" text-anchor="middle" fill="red" font-weight="bold" font-size="10">NOW</text>
                                    </svg>
                                `;
                                
                                timelineDiv.appendChild(nowSvgContainer);
                                
                                // Th√™m hi·ªÉn th·ªã ph·∫ßn trƒÉm d∆∞·ªõi ƒë∆∞·ªùng NOW
                                const nowPercentage = document.createElement('div');
                                nowPercentage.className = 'now-percentage';
                                nowPercentage.textContent = `${Math.round(tf.percent)}%`;
                                nowPercentage.style.left = `${tf.percent}%`;
                                nowPercentage.style.textAlign = 'center'; // ƒê·∫£m b·∫£o text ·ªü gi·ªØa
                                nowPercentage.style.width = '30px'; // Chi·ªÅu r·ªông c·ªë ƒë·ªãnh
                                nowPercentage.style.marginLeft = '-15px'; // C√¢n ƒë·ªëi v·ªõi v·∫°ch ƒë·ªè
                                nowPercentage.style.bottom = '-18px'; // ƒêi·ªÅu ch·ªânh v·ªã tr√≠ xu·ªëng th·∫•p h∆°n ƒë·ªÉ kh√¥ng ƒë√® l√™n nh√£n 1/4
                                nowPercentage.id = `now-percentage-${safeId}`;
                                timelineDiv.appendChild(nowPercentage);
                                
                                // X√°c ƒë·ªãnh c√°c d·∫•u ch·∫•m theo t·ª´ng Q
                                const dotPositions = [];
                                for (let q = 0; q < 4; q++) {
                                    // V·ªã tr√≠ b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c c·ªßa Q
                                    const qStart = q * 25;
                                    
                                    // Chia m·ªói Q th√†nh 4 ph·∫ßn b·∫±ng nhau
                                    for (let i = 0; i < 4; i++) {
                                        // T√≠nh v·ªã tr√≠ d·∫•u ch·∫•m: ƒë·∫ßu Q + kho·∫£ng c√°ch ƒë·ªÅu
                                        const dotPercent = qStart + (i * 25 / 4);
                                        dotPositions.push(dotPercent);
                                    }
                                }
                                // Th√™m v·ªã tr√≠ 100% v√†o cu·ªëi
                                dotPositions.push(100);
                                
                                // T·∫°o m·∫£ng th·ªùi gian t∆∞∆°ng ·ª©ng v·ªõi c√°c ƒëi·ªÉm
                                const timeMarkers = [];
                                
                                // T√≠nh to√°n th·ªùi gian ch√≠nh x√°c cho c√°c d·∫•u ch·∫•m d·ª±a tr√™n khung th·ªùi gian
                                if (tf.startTime && tf.endTime) {
                                    try {
                                        const startTime = new Date(tf.startTime);
                                        const endTime = new Date(tf.endTime);
                                        const timeRange = endTime - startTime;
                                        
                                        // T·∫°o c√°c m·ªëc th·ªùi gian cho t·ª´ng d·∫•u ch·∫•m
                                        for (let i = 0; i < dotPositions.length; i++) {
                                            const percentTime = dotPositions[i] / 100;
                                            const timePoint = new Date(startTime.getTime() + (timeRange * percentTime));
                                            
                                            // ƒê·ªãnh d·∫°ng ng√†y v√† gi·ªù
                                            const datePart = `${String(timePoint.getDate()).padStart(2, '0')}/${String(timePoint.getMonth() + 1).padStart(2, '0')}`;
                                            const timePart = `${String(timePoint.getHours()).padStart(2, '0')}:${String(timePoint.getMinutes()).padStart(2, '0')}`;
                                            
                                            // ƒê·∫£m b·∫£o d·∫•u ch·∫•m ƒë·∫ßu ti√™n v√† cu·ªëi c√πng ch√≠nh x√°c v·ªõi th·ªùi gian b·∫Øt ƒë·∫ßu/k·∫øt th√∫c
                                            if (i === 0) {
                                                // D·∫•u ch·∫•m ƒë·∫ßu ti√™n lu√¥n l√† th·ªùi gian b·∫Øt ƒë·∫ßu ch√≠nh x√°c
                                                const startDateParts = tf.startDate.split(' ');
                                                const startDateOnly = startDateParts[0].split('/');
                                                const startDateFormatted = startDateOnly.length >= 2 ? 
                                                    `${startDateOnly[0]}/${startDateOnly[1]}` : datePart;
                                                    
                                                const startTimeFormatted = startDateParts.length > 1 ? 
                                                    startDateParts[1] : `${String(startTime.getHours()).padStart(2, '0')}:${String(startTime.getMinutes()).padStart(2, '0')}`;
                                                
                                                timeMarkers.push([startDateFormatted, startTimeFormatted]);
                                            } 
                                            else if (i === dotPositions.length - 1) {
                                                // D·∫•u ch·∫•m cu·ªëi c√πng lu√¥n l√† th·ªùi gian k·∫øt th√∫c ch√≠nh x√°c
                                                const endDateParts = tf.endDate ? tf.endDate.split(' ') : [];
                                                const endDateOnly = endDateParts.length > 0 ? endDateParts[0].split('/') : [];
                                                const endDateFormatted = endDateOnly.length >= 2 ? 
                                                    `${endDateOnly[0]}/${endDateOnly[1]}` : datePart;
                                                    
                                                const endTimeFormatted = endDateParts.length > 1 ? 
                                                    endDateParts[1] : `${String(endTime.getHours()).padStart(2, '0')}:${String(endTime.getMinutes()).padStart(2, '0')}`;
                                                
                                                timeMarkers.push([endDateFormatted, endTimeFormatted]);
                                            }
                                            else {
                                                timeMarkers.push([datePart, timePart]);
                                            }
                                        }
                                    } catch (error) {
                                        console.error("L·ªói khi t√≠nh th·ªùi gian cho " + tf.name, error);
                                        // N·∫øu kh√¥ng c√≥ th·ªùi gian b·∫Øt ƒë·∫ßu/k·∫øt th√∫c, t·∫°o m·ªëc th·ªùi gian m·∫∑c ƒë·ªãnh
                                        createDefaultTimeMarkers(tf, timeMarkers, dotPositions.length);
                                    }
                                } else {
                                    // N·∫øu kh√¥ng c√≥ th·ªùi gian b·∫Øt ƒë·∫ßu/k·∫øt th√∫c, t·∫°o m·ªëc th·ªùi gian m·∫∑c ƒë·ªãnh
                                    createDefaultTimeMarkers(tf, timeMarkers, dotPositions.length);
                                }
                                
                                // T√≠nh to√°n v·ªã tr√≠ ph·∫ßn trƒÉm hi·ªán t·∫°i
                                const nowIndex = Math.min(timeMarkers.length - 1, Math.floor(tf.percent * (timeMarkers.length - 1) / 100));
                                
                                // Th√™m c√°c m·ªëc th·ªùi gian v√†o timeline
                                const markersDiv = document.createElement('div');
                                markersDiv.className = 'time-markers';
                                markersDiv.style.position = 'absolute';
                                markersDiv.style.width = '100%';
                                markersDiv.style.bottom = '-40px'; // ƒê·∫∑t m·ªëc th·ªùi gian xu·ªëng d∆∞·ªõi
                                markersDiv.style.display = 'flex';
                                markersDiv.style.justifyContent = 'space-between';
                                markersDiv.style.alignItems = 'flex-start';
                                markersDiv.style.fontSize = '9px';
                                markersDiv.style.color = '#333';
                                
                                // X√≥a t·∫•t c·∫£ marker hi·ªán t·∫°i
                                markersDiv.innerHTML = '';
                                
                                // Th√™m d·∫•u ch·∫•m v√†o timeline theo m·∫´u 40.jpg
                                for (let i = 0; i < dotPositions.length; i++) {
                                    // Ki·ªÉm tra n·∫øu l√† khung th·ªùi gian 1m, 5m ho·∫∑c 15m th√¨ b·ªè qua kh√¥ng t·∫°o d·∫•u ch·∫•m
                                    if (tf.name === "1m" || tf.name === "5m" || tf.name === "15m") {
                                        continue;
                                    }
                                    
                                    // T·∫°o d·∫•u ch·∫•m th·ªùi gian
                                    const dotElement = document.createElement('div');
                                    dotElement.className = 'timeline-dot';
                                    dotElement.style.position = 'absolute';
                                    dotElement.style.left = `${dotPositions[i]}%`;
                                    dotElement.style.top = '7px'; // ƒê·∫∑t ch√≠nh gi·ªØa timeline
                                    dotElement.style.transform = 'translate(-50%, 0)';
                                    dotElement.style.borderRadius = '50%';
                                    dotElement.style.zIndex = '5';
                                    
                                    // L√†m n·ªïi b·∫≠t c√°c d·∫•u ch·∫•m t·∫°i c√°c ƒëi·ªÉm Q ch√≠nh
                                    if (i === 0 || i === 4 || i === 8 || i === 12 || i === 16) {
                                        dotElement.style.width = '6px';
                                        dotElement.style.height = '6px';
                                        dotElement.style.border = '1px solid white';
                                        dotElement.style.backgroundColor = '#000'; // T·∫•t c·∫£ d·∫•u ch·∫•m ch√≠nh ƒë·ªÅu m√†u ƒëen
                                    } else {
                                        // D·∫•u ch·∫•m th∆∞·ªùng nh·ªè h∆°n
                                        dotElement.style.width = '3px';
                                        dotElement.style.height = '3px';
                                        dotElement.style.backgroundColor = '#000'; // M√†u ƒëen cho c√°c d·∫•u ch·∫•m nh·ªè
                                        dotElement.style.border = '1px solid rgba(255,255,255,0.3)';
                                    }
                                    
                                    // ƒê√°nh d·∫•u ƒë·∫∑c bi·ªát cho d·∫•u ch·∫•m ·ªü 50%
                                    if (Math.abs(dotPositions[i] - 50) < 0.1) {
                                        dotElement.style.backgroundColor = 'red';
                                        dotElement.style.width = '6px';
                                        dotElement.style.height = '6px';
                                        dotElement.style.border = '1px solid white';
                                        dotElement.style.zIndex = '12';
                                    }
                                    
                                    // ƒê√°nh d·∫•u ƒë·∫∑c bi·ªát cho d·∫•u ch·∫•m NOW
                                    if (i === nowIndex) {
                                        // Kh√¥ng hi·ªÉn th·ªã d·∫•u ch·∫•m ƒë·ªè NOW v√¨ ƒë√£ c√≥ ch·ªâ b√°o NOW ri√™ng
                                        // dotElement.style.backgroundColor = 'red';
                                        // dotElement.style.border = '1px solid white';
                                        // dotElement.style.width = '7px';
                                        // dotElement.style.height = '7px';
                                        // dotElement.style.zIndex = '15';
                                        // dotElement.style.boxShadow = '0 0 3px white';
                                    }
                                    
                                    timelineDiv.appendChild(dotElement);
                                    
                                    // Hi·ªÉn th·ªã th·ªùi gian TR√äN d·∫•u ch·∫•m - style nh∆∞ m·∫´u 40.jpg
                                    if (i < timeMarkers.length) {
                                        // Ki·ªÉm tra tr√πng l·∫∑p v·ªõi d·∫•u ch·∫•m tr∆∞·ªõc ƒë√≥
                                        let shouldDisplay = true;
                                        
                                        // Ch·ªâ ki·ªÉm tra tr√πng l·∫∑p n·∫øu kh√¥ng ph·∫£i l√† d·∫•u ch·∫•m ƒë·∫ßu ti√™n v√† kh√¥ng ph·∫£i d·∫•u ch·∫•m ch√≠nh
                                        if (i > 0 && i % 4 !== 0 && i !== timeMarkers.length - 1) {
                                            // So s√°nh v·ªõi d·∫•u ch·∫•m tr∆∞·ªõc ƒë√≥
                                            const prevMarker = timeMarkers[i-1];
                                            const currentMarker = timeMarkers[i];
                                            
                                            // N·∫øu ng√†y v√† gi·ªù gi·ªëng nhau, kh√¥ng hi·ªÉn th·ªã
                                            if (prevMarker[0] === currentMarker[0] && prevMarker[1] === currentMarker[1]) {
                                                shouldDisplay = false;
                                            }
                                            
                                            // N·∫øu kho·∫£ng c√°ch gi·ªØa 2 d·∫•u ch·∫•m qu√° g·∫ßn, kh√¥ng hi·ªÉn th·ªã
                                            if (Math.abs(dotPositions[i] - dotPositions[i-1]) < 6) {
                                                shouldDisplay = false;
                                            }
                                        }
                                        
                                        // Lu√¥n hi·ªÉn th·ªã c√°c d·∫•u ch·∫•m ch√≠nh (ƒë·∫ßu Q) v√† d·∫•u ch·∫•m hi·ªán t·∫°i
                                        if (i === 0 || i === 4 || i === 8 || i === 12 || i === 16 || i === nowIndex) {
                                            shouldDisplay = true;
                                        }
                                        
                                        if (shouldDisplay) {
                                            const markerDiv = document.createElement('div');
                                            markerDiv.style.position = 'absolute';
                                            markerDiv.style.left = `${dotPositions[i]}%`;
                                            markerDiv.style.transform = 'translateX(-50%)';
                                            markerDiv.style.top = '-30px'; // Chuy·ªÉn t·ª´ bottom l√™n top
                                            markerDiv.style.textAlign = 'center';
                                            markerDiv.style.width = '40px';
                                            markerDiv.style.fontSize = '8px';
                                            markerDiv.style.fontFamily = 'monospace';
                                            markerDiv.style.color = '#333';
                                            markerDiv.style.lineHeight = '1.2';
                                            
                                            // Hi·ªÉn th·ªã ng√†y/th√°ng
                                            const dateDiv = document.createElement('div');
                                            dateDiv.textContent = timeMarkers[i][0];
                                            markerDiv.appendChild(dateDiv);
                                            
                                            // Hi·ªÉn th·ªã gi·ªù:ph√∫t
                                            const timeDiv = document.createElement('div');
                                            timeDiv.textContent = timeMarkers[i][1];
                                            markerDiv.appendChild(timeDiv);
                                            
                                            // Highlight th·ªùi gian hi·ªán t·∫°i
                                            if (i === nowIndex) {
                                                dateDiv.style.color = 'red';
                                                timeDiv.style.color = 'red';
                                                dateDiv.style.fontWeight = 'bold';
                                                timeDiv.style.fontWeight = 'bold';
                                            }
                                            
                                            markersDiv.appendChild(markerDiv);
                                        }
                                    }
                                }
                                
                                // L∆∞u tr·ªØ timeMarkers v√†o dataset c·ªßa timeline ƒë·ªÉ c√≥ th·ªÉ s·ª≠ d·ª•ng khi c·∫≠p nh·∫≠t
                                timelineDiv.dataset.timeMarkers = JSON.stringify(timeMarkers);
                                
                                // Th√™m nh√£n 1/4 ƒë·∫ßu, 1/4 th·ª© 2, 1/4 th·ª© 3, 1/4 cu·ªëi c√πng v√†o d∆∞·ªõi timeline - style theo 40.jpg
                                const quarterLabels = [
                                    { text: "1/4 ƒë·∫ßu", left: "12.5%", color: "#0ea5e9" },  // Gi·ªØa Q1
                                    { text: "1/4 th·ª© 2", left: "37.5%", color: "#10b981" }, // Gi·ªØa Q2
                                    { text: "1/4 th·ª© 3", left: "62.5%", color: "#eab308" }, // Gi·ªØa Q3
                                    { text: "1/4 cu·ªëi c√πng", left: "87.5%", color: "#ec4899" } // Gi·ªØa Q4
                                ];
                                
                                // Th√™m m·ªôt div cho ph·∫ßn n·ªÅn c·ªßa nh√£n 1/4
                                const quarterLabelBackground = document.createElement('div');
                                quarterLabelBackground.style.position = 'absolute';
                                quarterLabelBackground.style.left = '0';
                                quarterLabelBackground.style.right = '0';
                                quarterLabelBackground.style.bottom = '-25px'; // Chuy·ªÉn l√™n cao h∆°n v√¨ kh√¥ng c√≤n ng√†y gi·ªù b√™n d∆∞·ªõi
                                quarterLabelBackground.style.height = '15px';
                                quarterLabelBackground.style.backgroundColor = 'rgba(240, 240, 240, 0.5)';
                                timelineDiv.appendChild(quarterLabelBackground);
                                
                                for (const label of quarterLabels) {
                                    const labelDiv = document.createElement('div');
                                    labelDiv.textContent = label.text;
                                    labelDiv.style.position = 'absolute';
                                    labelDiv.style.left = label.left;
                                    labelDiv.style.transform = 'translateX(-50%)';
                                    labelDiv.style.bottom = '-25px'; // Chuy·ªÉn l√™n cao h∆°n v√¨ kh√¥ng c√≤n ng√†y gi·ªù b√™n d∆∞·ªõi
                                    labelDiv.style.color = label.color;
                                    labelDiv.style.fontWeight = 'bold';
                                    labelDiv.style.fontSize = '10px';
                                    labelDiv.style.textAlign = 'center';
                                    labelDiv.style.width = '80px';
                                    labelDiv.style.zIndex = '2';
                                    
                                    timelineDiv.appendChild(labelDiv);
                                }
                                
                                // Th√™m ng√†y/gi·ªù k·∫øt th√∫c ·ªü d∆∞·ªõi b√™n ph·∫£i timeline - style theo 40.jpg
                                if (timeMarkers.length > 0) {
                                    // L·∫•y th·ªùi gian b·∫Øt ƒë·∫ßu t·ª´ timeMarkers[0] ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t
                                    const startDateTimeDiv = document.createElement('div');
                                    startDateTimeDiv.textContent = `${timeMarkers[0][0]} ${timeMarkers[0][1]}`;
                                    startDateTimeDiv.style.position = 'absolute';
                                    startDateTimeDiv.style.left = '0';
                                    startDateTimeDiv.style.bottom = '-45px'; // Chuy·ªÉn l√™n cao h∆°n
                                    startDateTimeDiv.style.fontSize = '9px';
                                    startDateTimeDiv.style.fontFamily = 'monospace';
                                    startDateTimeDiv.style.color = '#333';
                                    timelineDiv.appendChild(startDateTimeDiv);
                                    
                                    // L·∫•y th·ªùi gian k·∫øt th√∫c t·ª´ timeMarkers cu·ªëi c√πng ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t
                                    const endDateTimeDiv = document.createElement('div');
                                    const lastIndex = timeMarkers.length - 1;
                                    endDateTimeDiv.textContent = `${timeMarkers[lastIndex][0]} ${timeMarkers[lastIndex][1]}`;
                                    endDateTimeDiv.style.position = 'absolute';
                                    endDateTimeDiv.style.right = '0';
                                    endDateTimeDiv.style.bottom = '-45px'; // Chuy·ªÉn l√™n cao h∆°n
                                    endDateTimeDiv.style.fontSize = '9px';
                                    endDateTimeDiv.style.fontFamily = 'monospace';
                                    endDateTimeDiv.style.color = '#333';
                                    timelineDiv.appendChild(endDateTimeDiv);
                                }
                                
                                timelineDiv.appendChild(markersDiv);
                                contentDiv.appendChild(timelineDiv);
                                
                                // Th√™m th√¥ng tin th·ªùi gian c√≤n l·∫°i v√† ti·∫øn tr√¨nh
                                const statsDiv = document.createElement('div');
                                statsDiv.className = 'time-frame-stats';
                                
                                // Th√™m th√¥ng tin c√≤n l·∫°i v·ªõi t√™n khung
                                const remainingDiv = document.createElement('div');
                                remainingDiv.className = 'time-remaining';
                                remainingDiv.textContent = `${tf.name} C√≤n l·∫°i: ${tf.remaining}`;
                                statsDiv.appendChild(remainingDiv);
                                
                                // Th√™m th√¥ng tin ti·∫øn ƒë·ªô v·ªõi t√™n khung
                                const progressDiv = document.createElement('div');
                                progressDiv.className = 'time-progress';
                                progressDiv.textContent = `${tf.name} ${Math.round(tf.percent)}% ho√†n th√†nh`;
                                statsDiv.appendChild(progressDiv);

                                // Th√™m th√¥ng tin ƒë·∫øn 50% v·ªõi t√™n khung
                                const halfwayTimeDiv = document.createElement('div');
                                halfwayTimeDiv.className = 'time-halfway';
                                halfwayTimeDiv.textContent = `${tf.name} ƒê·∫øn 50%: ${tf.toHalf}`;
                                halfwayTimeDiv.style.color = tf.toHalf !== "ƒê√£ qua" ? "#DC143C" : "#666666";
                                halfwayTimeDiv.style.fontWeight = "bold";
                                statsDiv.appendChild(halfwayTimeDiv);
                                
                                // Th√™m th√¥ng tin pha v·ªõi t√™n khung v√† m√†u t∆∞∆°ng ·ª©ng v·ªõi m√†u n·ªÅn
                                const phaseNameDiv = document.createElement('div');
                                phaseNameDiv.className = 'phase-name';
                                
                                // X√°c ƒë·ªãnh m√†u t∆∞∆°ng ·ª©ng cho t·ª´ng pha - ƒê·ªçc t·ª´ localStorage n·∫øu c√≥
                                let phaseColor;
                                const savedColors = localStorage.getItem('bmag-colors');
                                const colors = savedColors ? JSON.parse(savedColors) : {
                                    phase1: '#0ea5e9',
                                    phase2: '#10b981',
                                    phase3: '#eab308',
                                    phase4: '#ec4899'
                                };
                                
                                // L·∫•y m√†u n·ªÅn hi·ªán t·∫°i c·ªßa pha t∆∞∆°ng ·ª©ng
                                const phaseElements = document.querySelectorAll('.phase');
                                let actualPhaseColor;
                                
                                if (tf.phase === "Q1") {
                                    const phase1Element = document.querySelector('.phase1');
                                    actualPhaseColor = phase1Element ? getComputedStyle(phase1Element).backgroundColor : colors.phase1;
                                } else if (tf.phase === "Q2") {
                                    const phase2Element = document.querySelector('.phase2');
                                    actualPhaseColor = phase2Element ? getComputedStyle(phase2Element).backgroundColor : colors.phase2;
                                } else if (tf.phase === "Q3") {
                                    const phase3Element = document.querySelector('.phase3');
                                    actualPhaseColor = phase3Element ? getComputedStyle(phase3Element).backgroundColor : colors.phase3;
                                } else { // Q4
                                    const phase4Element = document.querySelector('.phase4');
                                    actualPhaseColor = phase4Element ? getComputedStyle(phase4Element).backgroundColor : colors.phase4;
                                }
                                
                                // Hi·ªÉn th·ªã t√™n pha v·ªõi m√†u t∆∞∆°ng ·ª©ng v·ªõi m√†u n·ªÅn th·ª±c t·∫ø
                                phaseNameDiv.textContent = `${tf.name} Pha ${tf.phase}: ${tf.phase_name.split(':')[1].trim()}`;
                                phaseNameDiv.style.color = actualPhaseColor;
                                phaseNameDiv.style.fontWeight = "bold";
                                statsDiv.appendChild(phaseNameDiv);
                                
                                contentDiv.appendChild(statsDiv);

                                // Th√™m advice t·ª´ BMaG
                                const adviceDiv = document.createElement('div');
                                adviceDiv.className = 'advice-section';
                                adviceDiv.textContent = tf.advice;
                                contentDiv.appendChild(adviceDiv);
                                
                                timeFrameDiv.appendChild(contentDiv);
                                container.appendChild(timeFrameDiv);
                            } catch (error) {
                                console.error(`L·ªói khi t·∫°o khung th·ªùi gian ${tf.name}:`, error);
                                // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói cho khung th·ªùi gian n√†y
                                const errorDiv = document.createElement('div');
                                errorDiv.className = 'time-frame';
                                errorDiv.style.backgroundColor = '#FFEBEE';
                                errorDiv.style.border = '1px solid #FFCDD2';
                                errorDiv.style.padding = '10px';
                                errorDiv.style.marginBottom = '10px';
                                errorDiv.style.borderRadius = '4px';
                                errorDiv.innerHTML = `<strong style="color: #D32F2F;">L·ªói khi t·∫°o khung th·ªùi gian ${tf.name}:</strong> ${error.message}`;
                                container.appendChild(errorDiv);
                            }
                        });
                    });
                } catch (error) {
                    console.error('L·ªói khi t·∫°o khung th·ªùi gian:', error);
                    container.innerHTML = `<div class="loading" style="display: flex; justify-content: center; align-items: center; height: 100px; font-size: 18px; color: #D32F2F; margin: 20px 0; padding: 20px; border: 1px dashed #FFCDD2; border-radius: 8px; background-color: #FFEBEE;">
                        <div>
                            <p><strong>L·ªói khi t·∫°o khung th·ªùi gian:</strong></p>
                            <p>${error.message}</p>
                            <p>Vui l√≤ng l√†m m·ªõi trang ho·∫∑c ki·ªÉm tra l·∫°i d·ªØ li·ªáu.</p>
                        </div>
                    </div>`;
                }
            }

            // Ki·ªÉm tra v√† hi·ªÉn th·ªã c·∫£nh b√°o ƒë·∫∑c bi·ªát
            function checkSpecialAlerts(timeframeData) {
                const alertDiv = document.getElementById('footer-special-alert');
                const alertMessage = document.getElementById('footer-alert-message');
                alertDiv.style.display = 'none';

                // S·ª≠ d·ª•ng h√†m t·ª´ BMaGAnalyzer
                const alertInfo = BMaGAnalyzer.checkSpecialAlerts(timeframeData);
                
                if (alertInfo.show) {
                    alertMessage.textContent = alertInfo.message;
                    alertDiv.style.display = 'block';
                } else {
                    // ·∫®n th√¥ng b√°o c·∫£nh b√°o n·∫øu kh√¥ng c√≥ c·∫£nh b√°o
                    alertDiv.style.display = 'none';
                }
            }

            // Thi·∫øt l·∫≠p filter dropdown
            function setupFilterDropdown() {
                const filterButton = document.getElementById('filter-button');
                const filterDropdown = document.getElementById('filter-dropdown');
                const allCheckbox = document.getElementById('all');
                
                // Hi·ªÉn th·ªã/·∫©n dropdown
                filterButton.addEventListener('click', function() {
                    if (filterDropdown.style.display === 'block') {
                        filterDropdown.style.display = 'none';
                    } else {
                        filterDropdown.style.display = 'block';
                    }
                });
                
                // ƒê√≥ng dropdown khi click ra ngo√†i
                document.addEventListener('click', function(event) {
                    if (!filterButton.contains(event.target) && !filterDropdown.contains(event.target)) {
                        filterDropdown.style.display = 'none';
                    }
                });
                
                // X·ª≠ l√Ω checkbox "T·∫•t c·∫£"
                allCheckbox.addEventListener('change', function() {
                    const checkboxes = filterDropdown.querySelectorAll('input[type="checkbox"]');
                    checkboxes.forEach(checkbox => {
                        if (checkbox.id !== 'all' && checkbox.id !== 'filter-Q3-only') {
                            checkbox.checked = allCheckbox.checked;
                            const roleKey = checkbox.id.replace('filter-', '').replace(/-/g, ' ').replace('Sieu Chu Dao', 'Si√™u Ch·ªß ƒê·∫°o').replace('K Chu Dao', 'K.Ch·ªß ƒê·∫°o').replace('Ho Tro', 'H·ªó Tr·ª£').replace('Chu Dao', 'Ch·ªß ƒê·∫°o').replace('Giao Pha', 'Giao Pha');
                            activeFilters[roleKey] = allCheckbox.checked;
                        }
                    });
                    updateFilterStatus();
                    createTimeFrames();
                });
                
                // X·ª≠ l√Ω c√°c checkbox kh√°c
                const roleCheckboxes = filterDropdown.querySelectorAll('input[type="checkbox"]:not(#all):not(#filter-Q3-only)');
                roleCheckboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const roleKey = checkbox.id.replace('filter-', '').replace(/-/g, ' ').replace('Sieu Chu Dao', 'Si√™u Ch·ªß ƒê·∫°o').replace('K Chu Dao', 'K.Ch·ªß ƒê·∫°o').replace('Ho Tro', 'H·ªó Tr·ª£').replace('Chu Dao', 'Ch·ªß ƒê·∫°o').replace('Giao Pha', 'Giao Pha');
                        activeFilters[roleKey] = checkbox.checked;
                        
                        // C·∫≠p nh·∫≠t tr·∫°ng th√°i checkbox "T·∫•t c·∫£"
                        const allChecked = Array.from(roleCheckboxes).every(cb => cb.checked);
                        allCheckbox.checked = allChecked;
                        
                        updateFilterStatus();
                        createTimeFrames();
                    });
                });
                
                // X·ª≠ l√Ω checkbox Q3 Only
                const q3Checkbox = document.getElementById('filter-Q3-only');
                q3Checkbox.addEventListener('change', function() {
                    activeFilters.Q3Only = q3Checkbox.checked;
                    updateFilterStatus();
                    createTimeFrames();
                });
            }
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i b·ªô l·ªçc hi·ªÉn th·ªã
            function updateFilterStatus() {
                const filterStatus = document.getElementById('filter-status');
                
                if (activeFilters.Q3Only) {
                    filterStatus.textContent = 'Ch·ªâ Q3 (Cao tr√†o)';
                    return;
                }
                
                const activeRoles = [];
                if (activeFilters['Si√™u Ch·ªß ƒê·∫°o']) activeRoles.push('SCƒê');
                if (activeFilters['Ch·ªß ƒê·∫°o']) activeRoles.push('Cƒê');
                if (activeFilters['Giao Pha']) activeRoles.push('GP');
                if (activeFilters['H·ªó Tr·ª£']) activeRoles.push('HT');
                if (activeFilters['K.Ch·ªß ƒê·∫°o']) activeRoles.push('KCƒê');
                
                if (activeRoles.length === 5) {
                    filterStatus.textContent = 'T·∫•t c·∫£';
                } else if (activeRoles.length === 0) {
                    filterStatus.textContent = 'Kh√¥ng c√≥';
                } else {
                    filterStatus.textContent = activeRoles.join(', ');
                }
            }
            
            // Kh·ªüi t·∫°o v√† c·∫≠p nh·∫≠t m·ªói gi√¢y
            updateCurrentTime();
            createTimeFrames();
            setupFilterDropdown();
            
            // C·∫≠p nh·∫≠t th√¥ng tin th·ªùi gian ngay khi trang ƒë∆∞·ª£c t·∫£i
            document.getElementById('footer-current-time').textContent = `NOW: ${BMaGAnalyzer.updateCurrentTime().formatted}`;
            document.getElementById('footer-timeframe-info').innerHTML = `üïñ Th·ªùi gian hi·ªán t·∫°i: ${new Date().toLocaleString('vi-VN')} (GMT+7)`;
            
            // H√†m c·∫≠p nh·∫≠t v·ªã tr√≠ NOW
            function updateNowPositions() {
                // L·∫•y d·ªØ li·ªáu th·ªùi gian m·ªõi - T√≠nh to√°n l·∫°i th·ªùi gian th·ª±c
                const timeframeData = BMaGAnalyzer.generateTimeframeData();
                
                timeframeData.forEach(tf => {
                    // X·ª≠ l√Ω ID an to√†n
                    const safeId = tf.name.replace(/\s+/g, '-').replace(/[^a-zA-Z0-9-]/g, '');
                    
                    // C·∫≠p nh·∫≠t v·ªã tr√≠ marker NOW
                    const marker = document.getElementById(`now-marker-${safeId}`);
                    if (marker) {
                        marker.style.left = `${tf.percent}%`;
                    }
                    
                    // C·∫≠p nh·∫≠t v·ªã tr√≠ v√† n·ªôi dung ph·∫ßn trƒÉm
                    const percentage = document.getElementById(`now-percentage-${safeId}`);
                    if (percentage) {
                        percentage.style.left = `${tf.percent}%`;
                        percentage.textContent = `${Math.round(tf.percent)}%`;
                    }
                    
                    // C·∫≠p nh·∫≠t d·∫•u ch·∫•m hi·ªán t·∫°i
                    const nowIndex = Math.floor(tf.percent * 12 / 100);
                    const timelineDiv = marker ? marker.closest('.timeline') : null;
                    
                    if (timelineDiv) {
                        // C·∫≠p nh·∫≠t hi·ªÉn th·ªã d·∫•u ch·∫•m hi·ªán t·∫°i
                        const dots = timelineDiv.querySelectorAll('.timeline-dot');
                        
                        // Ki·ªÉm tra n·∫øu l√† khung th·ªùi gian 1m, 5m ho·∫∑c 15m th√¨ b·ªè qua vi·ªác c·∫≠p nh·∫≠t d·∫•u ch·∫•m
                        if (tf.name === "1m" || tf.name === "5m" || tf.name === "15m") {
                            // X√≥a t·∫•t c·∫£ d·∫•u ch·∫•m hi·ªán c√≥ n·∫øu c√≥
                            dots.forEach(dot => {
                                dot.remove();
                            });
                        } else {
                            dots.forEach((dot, index) => {
                                if (index === nowIndex) {
                                    // Kh√¥ng hi·ªÉn th·ªã d·∫•u ch·∫•m ƒë·ªè NOW v√¨ ƒë√£ c√≥ ch·ªâ b√°o NOW ri√™ng
                                    // dot.style.backgroundColor = 'red';
                                    // dot.style.border = '1px solid white';
                                    // dot.style.width = '7px';
                                    // dot.style.height = '7px';
                                    // dot.style.zIndex = '15';
                                    // dot.style.boxShadow = '0 0 3px white';
                                } else {
                                    // Kh√¥i ph·ª•c l·∫°i k√≠ch th∆∞·ªõc v√† style ban ƒë·∫ßu
                                    if (index === 0 || index === 4 || index === 8 || index === 12 || index === 16) {
                                        dot.style.width = '6px';
                                        dot.style.height = '6px';
                                        
                                        // ƒê·∫∑t l·∫°i m√†u d·ª±a tr√™n pha - t·∫•t c·∫£ d·∫•u ch·∫•m ƒë·ªÅu m√†u ƒëen
                                        dot.style.backgroundColor = '#000'; // T·∫•t c·∫£ d·∫•u ch·∫•m ƒë·ªÅu m√†u ƒëen
                                        
                                        // ƒê√°nh d·∫•u ƒë·∫∑c bi·ªát cho d·∫•u ch·∫•m ·ªü 50%
                                        const dotPosition = (index / dots.length) * 100;
                                        if (Math.abs(dotPosition - 50) < 0.1) {
                                            dot.style.backgroundColor = 'red';
                                            dot.style.width = '6px';
                                            dot.style.height = '6px';
                                            dot.style.border = '1px solid white';
                                            dot.style.zIndex = '12';
                                        }
                                    } else {
                                        // D·∫•u ch·∫•m th∆∞·ªùng nh·ªè h∆°n
                                        dot.style.width = '3px';
                                        dot.style.height = '3px';
                                        dot.style.backgroundColor = '#000'; // M√†u ƒëen cho c√°c d·∫•u ch·∫•m nh·ªè
                                        dot.style.border = '1px solid rgba(255,255,255,0.3)';
                                    }
                                    
                                    dot.style.zIndex = '5';
                                    dot.style.boxShadow = 'none';
                                }
                            });
                        }
                        
                        // C·∫≠p nh·∫≠t hi·ªÉn th·ªã marker th·ªùi gian hi·ªán t·∫°i v√† x·ª≠ l√Ω tr√πng l·∫∑p
                        const markersContainer = timelineDiv.querySelector('.time-markers');
                        if (markersContainer && timelineDiv.dataset.timeMarkers) {
                            try {
                                // L·∫•y d·ªØ li·ªáu timeMarkers t·ª´ dataset
                                const timeMarkers = JSON.parse(timelineDiv.dataset.timeMarkers);
                                
                                // T√≠nh to√°n l·∫°i nowIndex d·ª±a tr√™n ph·∫ßn trƒÉm hi·ªán t·∫°i
                                const nowIndex = Math.min(timeMarkers.length - 1, Math.floor(tf.percent * (timeMarkers.length - 1) / 100));
                                
                                // C·∫≠p nh·∫≠t tr·∫°ng th√°i cho c√°c marker hi·ªán c√≥
                                const markerElements = markersContainer.querySelectorAll('div');
                                let visibleMarkerIndex = 0;
                                
                                markerElements.forEach(markerEl => {
                                    // T√¨m c√°c ph·∫ßn t·ª≠ con ch·ª©a ng√†y v√† gi·ªù
                                    const dateDiv = markerEl.querySelector('div:first-child');
                                    const timeDiv = markerEl.querySelector('div:last-child');
                                    
                                    if (dateDiv && timeDiv) {
                                        // Ki·ªÉm tra xem marker n√†y c√≥ ph·∫£i l√† v·ªã tr√≠ NOW kh√¥ng
                                        if (visibleMarkerIndex === nowIndex) {
                                            dateDiv.style.color = 'red';
                                            timeDiv.style.color = 'red';
                                            dateDiv.style.fontWeight = 'bold';
                                            timeDiv.style.fontWeight = 'bold';
                                            markerEl.classList.add('now');
                                        } else {
                                            dateDiv.style.color = '#333';
                                            timeDiv.style.color = '#333';
                                            dateDiv.style.fontWeight = 'normal';
                                            timeDiv.style.fontWeight = 'normal';
                                            markerEl.classList.remove('now');
                                        }
                                        
                                        visibleMarkerIndex++;
                                    }
                                });
                            } catch (error) {
                                console.error('L·ªói khi c·∫≠p nh·∫≠t markers:', error);
                            }
                        }
                    }
                    
                    // C·∫≠p nh·∫≠t th√¥ng tin th·ªùi gian v√† ph·∫ßn trƒÉm
                    // T√¨m c√°c ph·∫ßn t·ª≠ hi·ªÉn th·ªã th√¥ng tin
                    const timeFrameElements = document.querySelectorAll('.time-frame');
                    timeFrameElements.forEach(frameEl => {
                        // Ki·ªÉm tra xem frameEl c√≥ ph·∫£i l√† khung th·ªùi gian c·ªßa tf kh√¥ng
                        const frameName = frameEl.querySelector('.time-frame-name');
                        if (frameName && frameName.textContent.includes(tf.name)) {
                            // C·∫≠p nh·∫≠t th√¥ng tin c√≤n l·∫°i
                            const remainingEl = frameEl.querySelector('.time-remaining');
                            if (remainingEl) {
                                remainingEl.textContent = `${tf.name} C√≤n l·∫°i: ${tf.remaining}`;
                            }
                            
                            // C·∫≠p nh·∫≠t th√¥ng tin % ho√†n th√†nh
                            const progressEl = frameEl.querySelector('.time-progress');
                            if (progressEl) {
                                progressEl.textContent = `${tf.name} ${Math.round(tf.percent)}% ho√†n th√†nh`;
                            }
                            
                            // C·∫≠p nh·∫≠t th√¥ng tin ƒë·∫øn 50%
                            const halfwayEl = frameEl.querySelector('.time-halfway');
                            if (halfwayEl) {
                                halfwayEl.textContent = `${tf.name} ƒê·∫øn 50%: ${tf.toHalf}`;
                                halfwayEl.style.color = tf.toHalf !== "ƒê√£ qua" ? "#DC143C" : "#666666";
                            }
                            
                            // C·∫≠p nh·∫≠t m√†u ch·ªØ c·ªßa th√¥ng tin pha
                            const phaseNameEl = frameEl.querySelector('.phase-name');
                            if (phaseNameEl) {
                                // L·∫•y m√†u n·ªÅn th·ª±c t·∫ø c·ªßa pha
                                let actualPhaseColor;
                                if (tf.phase === "Q1") {
                                    const phase1Element = document.querySelector('.phase1');
                                    actualPhaseColor = phase1Element ? getComputedStyle(phase1Element).backgroundColor : '#0ea5e9';
                                } else if (tf.phase === "Q2") {
                                    const phase2Element = document.querySelector('.phase2');
                                    actualPhaseColor = phase2Element ? getComputedStyle(phase2Element).backgroundColor : '#10b981';
                                } else if (tf.phase === "Q3") {
                                    const phase3Element = document.querySelector('.phase3');
                                    actualPhaseColor = phase3Element ? getComputedStyle(phase3Element).backgroundColor : '#eab308';
                                } else { // Q4
                                    const phase4Element = document.querySelector('.phase4');
                                    actualPhaseColor = phase4Element ? getComputedStyle(phase4Element).backgroundColor : '#ec4899';
                                }
                                phaseNameEl.style.color = actualPhaseColor;
                                
                                // C·∫≠p nh·∫≠t n·ªôi dung pha n·∫øu ƒë√£ thay ƒë·ªïi
                                if (!phaseNameEl.textContent.includes(tf.phase)) {
                                    phaseNameEl.textContent = `${tf.name} Pha ${tf.phase}: ${tf.phase_name.split(':')[1].trim()}`;
                                }
                            }
                            
                            // C·∫≠p nh·∫≠t l·ªõp active cho pha hi·ªán t·∫°i
                            const phaseElements = frameEl.querySelectorAll('.phase');
                            phaseElements.forEach((phaseEl, index) => {
                                if (phaseEl.textContent.includes(tf.phase)) {
                                    phaseEl.classList.add('phase-active');
                                    phaseEl.style.opacity = "1";
                                    phaseEl.style.fontWeight = "bold";
                                } else {
                                    phaseEl.classList.remove('phase-active');
                                    phaseEl.style.opacity = "";
                                    phaseEl.style.fontWeight = "";
                                }
                            });
                        }
                    });
                });
                
                // Ki·ªÉm tra v√† hi·ªÉn th·ªã c·∫£nh b√°o ƒë·∫∑c bi·ªát
                checkSpecialAlerts(timeframeData);
            }
            
            // G·ªçi ngay l·∫ßn ƒë·∫ßu
            updateNowPositions();
            
            // Sau ƒë√≥ c·∫≠p nh·∫≠t ƒë·ªãnh k·ª≥
            setInterval(() => {
                updateCurrentTime();
                updateNowPositions();
            }, 1000);
            
            // X·ª≠ l√Ω ƒëi·ªÅu ch·ªânh m√†u s·∫Øc
            const colorSettingsButton = document.getElementById('color-settings-button');
            const colorSettings = document.getElementById('color-settings');
            const applyColorsButton = document.getElementById('apply-colors');
            const resetColorsButton = document.getElementById('reset-colors');
            
            // M·∫∑c ƒë·ªãnh m√†u s·∫Øc
            const defaultColors = {
                phase1: '#0ea5e9',
                phase2: '#10b981',
                phase3: '#eab308',
                phase4: '#ec4899'
            };
            
            // Hi·ªán/·∫©n c√†i ƒë·∫∑t m√†u s·∫Øc
            colorSettingsButton.addEventListener('click', function() {
                if (colorSettings.style.display === 'block') {
                    colorSettings.style.display = 'none';
                } else {
                    colorSettings.style.display = 'block';
                }
            });
            
            // √Åp d·ª•ng m√†u s·∫Øc m·ªõi
            applyColorsButton.addEventListener('click', function() {
                const phase1Color = document.getElementById('phase1-color').value;
                const phase2Color = document.getElementById('phase2-color').value;
                const phase3Color = document.getElementById('phase3-color').value;
                const phase4Color = document.getElementById('phase4-color').value;
                
                // C·∫≠p nh·∫≠t CSS cho c√°c pha
                document.querySelectorAll('.phase1').forEach(el => el.style.backgroundColor = phase1Color);
                document.querySelectorAll('.phase2').forEach(el => el.style.backgroundColor = phase2Color);
                document.querySelectorAll('.phase3').forEach(el => el.style.backgroundColor = phase3Color);
                document.querySelectorAll('.phase4').forEach(el => el.style.backgroundColor = phase4Color);
                
                // L∆∞u v√†o localStorage
                localStorage.setItem('bmag-colors', JSON.stringify({
                    phase1: phase1Color,
                    phase2: phase2Color,
                    phase3: phase3Color,
                    phase4: phase4Color
                }));
                
                // Th√¥ng b√°o v√† t·ª± ƒë·ªông c·∫≠p nh·∫≠t
                colorSettings.style.display = 'none';
                createTimeFrames();
            });
            
            // Kh√¥i ph·ª•c m√†u m·∫∑c ƒë·ªãnh
            resetColorsButton.addEventListener('click', function() {
                document.getElementById('phase1-color').value = defaultColors.phase1;
                document.getElementById('phase2-color').value = defaultColors.phase2;
                document.getElementById('phase3-color').value = defaultColors.phase3;
                document.getElementById('phase4-color').value = defaultColors.phase4;
                
                // C·∫≠p nh·∫≠t CSS cho c√°c pha
                document.querySelectorAll('.phase1').forEach(el => el.style.backgroundColor = defaultColors.phase1);
                document.querySelectorAll('.phase2').forEach(el => el.style.backgroundColor = defaultColors.phase2);
                document.querySelectorAll('.phase3').forEach(el => el.style.backgroundColor = defaultColors.phase3);
                document.querySelectorAll('.phase4').forEach(el => el.style.backgroundColor = defaultColors.phase4);
                
                // X√≥a kh·ªèi localStorage
                localStorage.removeItem('bmag-colors');
                
                // Th√¥ng b√°o v√† t·ª± ƒë·ªông c·∫≠p nh·∫≠t
                colorSettings.style.display = 'none';
                createTimeFrames();
            });
            
            // Ki·ªÉm tra v√† √°p d·ª•ng m√†u t·ª´ localStorage khi t·∫£i trang
            const savedColors = localStorage.getItem('bmag-colors');
            if (savedColors) {
                const colors = JSON.parse(savedColors);
                document.getElementById('phase1-color').value = colors.phase1;
                document.getElementById('phase2-color').value = colors.phase2;
                document.getElementById('phase3-color').value = colors.phase3;
                document.getElementById('phase4-color').value = colors.phase4;
                
                // C·∫≠p nh·∫≠t CSS cho c√°c pha
                document.querySelectorAll('.phase1').forEach(el => el.style.backgroundColor = colors.phase1);
                document.querySelectorAll('.phase2').forEach(el => el.style.backgroundColor = colors.phase2);
                document.querySelectorAll('.phase3').forEach(el => el.style.backgroundColor = colors.phase3);
                document.querySelectorAll('.phase4').forEach(el => el.style.backgroundColor = colors.phase4);
            }

            // H√†m t·∫°o m·ªëc th·ªùi gian m·∫∑c ƒë·ªãnh
            function createDefaultTimeMarkers(timeframe, markersArray, numPoints) {
                const now = new Date();
                const currentYear = now.getFullYear(); // L∆∞u nƒÉm hi·ªán t·∫°i
                const tfName = timeframe.name || "unknown";
                
                // X√°c ƒë·ªãnh th·ªùi ƒëi·ªÉm b·∫Øt ƒë·∫ßu c·ªßa khung th·ªùi gian
                let startTime;
                let endTime;
                
                if (tfName === "Y1") {
                    // NƒÉm b·∫Øt ƒë·∫ßu t·ª´ 1/1 l√∫c 0h
                    startTime = new Date(Date.UTC(currentYear, 0, 1, 0, 0, 0, 0));
                    endTime = new Date(Date.UTC(currentYear + 1, 0, 1, 0, 0, 0, 0));
                    
                    // T·∫°o c√°c m·ªëc th·ªùi gian c·ª• th·ªÉ cho 4 qu√Ω c·ªßa nƒÉm
                    // Q1: 1/1
                    markersArray.push([`01/01/${currentYear}`, `07:00`]);
                    // Gi·ªØa Q1
                    markersArray.push([`15/02/${currentYear}`, `07:00`]);
                    // Q2: 1/4
                    markersArray.push([`01/04/${currentYear}`, `07:00`]);
                    // Gi·ªØa Q2
                    markersArray.push([`15/05/${currentYear}`, `07:00`]);
                    // Q3: 1/7
                    markersArray.push([`01/07/${currentYear}`, `07:00`]);
                    // Gi·ªØa Q3
                    markersArray.push([`15/08/${currentYear}`, `07:00`]);
                    // Q4: 1/10
                    markersArray.push([`01/10/${currentYear}`, `07:00`]);
                    // Gi·ªØa Q4
                    markersArray.push([`15/11/${currentYear}`, `07:00`]);
                    // NƒÉm k·∫øt th√∫c
                    markersArray.push([`31/12/${currentYear}`, `07:00`]);
                    
                    // D·ª´ng h√†m ·ªü ƒë√¢y v√¨ ƒë√£ t·∫°o ƒë·∫ßy ƒë·ªß c√°c m·ªëc th·ªùi gian
                    return;
                } else if (tfName === "M3") {
                    // Qu√Ω b·∫Øt ƒë·∫ßu t·ª´ th√°ng 1/4/7/10 ng√†y 1 l√∫c 0h
                    const currentQuarter = Math.floor(now.getUTCMonth() / 3);
                    const startMonth = currentQuarter * 3; // 0=Jan, 3=Apr, 6=Jul, 9=Oct
                    
                    startTime = new Date(Date.UTC(currentYear, startMonth, 1, 0, 0, 0, 0));
                    
                    // T√≠nh th·ªùi ƒëi·ªÉm k·∫øt th√∫c (ƒë·∫ßu qu√Ω ti·∫øp theo)
                    let nextQuarterMonth = startMonth + 3;
                    let nextQuarterYear = currentYear;
                    if (nextQuarterMonth > 11) {
                        nextQuarterMonth = 0;
                        nextQuarterYear++;
                    }
                    endTime = new Date(Date.UTC(nextQuarterYear, nextQuarterMonth, 1, 0, 0, 0, 0));
                } else if (tfName === "M1") {
                    // Th√°ng b·∫Øt ƒë·∫ßu t·ª´ ng√†y 1 l√∫c 0h
                    startTime = new Date(Date.UTC(currentYear, now.getUTCMonth(), 1, 0, 0, 0, 0));
                    
                    // T√≠nh th·ªùi ƒëi·ªÉm k·∫øt th√∫c (ƒë·∫ßu th√°ng ti·∫øp theo)
                    let nextMonth = now.getUTCMonth() + 1;
                    let nextYear = currentYear;
                    if (nextMonth > 11) {
                        nextMonth = 0;
                        nextYear++;
                    }
                    endTime = new Date(Date.UTC(nextYear, nextMonth, 1, 0, 0, 0, 0));
                } else if (tfName === "W1") {
                    // Tu·∫ßn b·∫Øt ƒë·∫ßu t·ª´ th·ª© Hai l√∫c 0h
                    const dayOfWeek = now.getUTCDay(); // 0 = Ch·ªß nh·∫≠t, 1 = Th·ª© hai, ...
                    const daysSinceMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
                    
                    startTime = new Date(Date.UTC(
                        currentYear,
                        now.getUTCMonth(),
                        now.getUTCDate() - daysSinceMonday,
                        0, 0, 0, 0
                    ));
                    
                    // Th·ªùi ƒëi·ªÉm k·∫øt th√∫c l√† th·ª© Hai tu·∫ßn sau
                    endTime = new Date(startTime);
                    endTime.setUTCDate(startTime.getUTCDate() + 7);
                } else if (tfName.startsWith("D")) {
                    // X√°c ƒë·ªãnh s·ªë ng√†y c·ªßa khung th·ªùi gian
                    const days = parseInt(tfName.substring(1));
                    
                    // Ng√†y b·∫Øt ƒë·∫ßu l√∫c 0h UTC
                    startTime = new Date(Date.UTC(
                        currentYear,
                        now.getUTCMonth(),
                        now.getUTCDate(),
                        0, 0, 0, 0
                    ));
                    
                    // Th·ªùi ƒëi·ªÉm k·∫øt th√∫c
                    endTime = new Date(startTime);
                    endTime.setUTCDate(startTime.getUTCDate() + days);
                } else if (tfName.startsWith("H")) {
                    // X√°c ƒë·ªãnh s·ªë gi·ªù c·ªßa khung th·ªùi gian
                    const hours = parseInt(tfName.substring(1));
                    
                    // Gi·ªù b·∫Øt ƒë·∫ßu
                    const currentHour = now.getUTCHours();
                    const startHour = Math.floor(currentHour / hours) * hours;
                    
                    startTime = new Date(Date.UTC(
                        currentYear,
                        now.getUTCMonth(),
                        now.getUTCDate(),
                        startHour, 0, 0, 0
                    ));
                    
                    // Th·ªùi ƒëi·ªÉm k·∫øt th√∫c
                    endTime = new Date(startTime);
                    endTime.setUTCHours(startTime.getUTCHours() + hours);
                } else if (tfName.endsWith("m")) {
                    // X√°c ƒë·ªãnh s·ªë ph√∫t c·ªßa khung th·ªùi gian
                    const minutes = parseInt(tfName.replace('m', ''));
                    
                    // Ph√∫t b·∫Øt ƒë·∫ßu
                    const currentMinute = now.getUTCMinutes();
                    const startMinute = Math.floor(currentMinute / minutes) * minutes;
                    
                    startTime = new Date(Date.UTC(
                        currentYear,
                        now.getUTCMonth(),
                        now.getUTCDate(),
                        now.getUTCHours(),
                        startMinute, 0, 0
                    ));
                    
                    // Th·ªùi ƒëi·ªÉm k·∫øt th√∫c
                    endTime = new Date(startTime);
                    endTime.setUTCMinutes(startTime.getUTCMinutes() + minutes);
                } else {
                    // M·∫∑c ƒë·ªãnh n·∫øu kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c khung th·ªùi gian
                    startTime = new Date();
                    endTime = new Date(startTime);
                    endTime.setUTCHours(startTime.getUTCHours() + 1);
                }
                
                // T√≠nh to√°n kho·∫£ng th·ªùi gian
                const timeRange = endTime - startTime;
                
                // T·∫°o c√°c m·ªëc th·ªùi gian cho t·ª´ng d·∫•u ch·∫•m
                for (let i = 0; i < numPoints; i++) {
                    const percentTime = i / (numPoints - 1);
                    const timePoint = new Date(startTime.getTime() + (timeRange * percentTime));
                    
                    // ƒê·ªãnh d·∫°ng ng√†y v√† gi·ªù
                    const datePart = `${String(timePoint.getUTCDate()).padStart(2, '0')}/${String(timePoint.getUTCMonth() + 1).padStart(2, '0')}`;
                    const timePart = `${String(timePoint.getUTCHours()).padStart(2, '0')}:${String(timePoint.getUTCMinutes()).padStart(2, '0')}`;
                    
                    // ƒê·ªëi v·ªõi khung th·ªùi gian d√†i (Y1, M3, M1, W1), hi·ªÉn th·ªã gi·ªù c·ªë ƒë·ªãnh l√† 07:00 theo quy t·∫Øc BMaG
                    const displayTimePart = (tfName === "Y1" || tfName === "M3" || tfName === "M1" || tfName === "W1") ? "07:00" : timePart;
                    
                    markersArray.push([datePart, displayTimePart]);
                }
            }

            // Thay b·∫±ng:

            // H√†m t·∫°o m·ªëc th·ªùi gian m·∫∑c ƒë·ªãnh - S·ª≠ d·ª•ng h√†m t·ª´ TimeCalculator
            function createDefaultTimeMarkers(timeframe, markersArray, numPoints) {
                // G·ªçi h√†m t·ª´ TimeCalculator ƒë·ªÉ t·∫°o m·ªëc th·ªùi gian
                TimeCalculator.createDefaultTimeMarkers(timeframe, markersArray, numPoints);
            }
        });
    </script>
</body>
</html>